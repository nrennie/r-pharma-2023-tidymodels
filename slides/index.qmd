---
title: "Introduction to machine learning with {tidymodels}"
subtitle: "R/Pharma 2023"
author: "Dr Nicola Rennie"
format:
  LUstyle-revealjs:
    footer: "[nrennie.github.io/r-pharma-2023-tidymodels](https://nrennie.github.io/r-pharma-2023-tidymodels)"
bibliography: references.bib
---

# Welcome!

## What to expect during this workshop

The workshop will run for *2 hours*.

* We'll take a 5 minute break halfway through.

* Combines slides, live coding examples, quiz questions, and exercises for you to participate in.

* Ask questions in the chat throughout!

## Workshop resources

* GitHub: [github.com/nrennie/r-pharma-2023-tidymodels](https://github.com/nrennie/r-pharma-2023-tidymodels)

* Slides: [nrennie.github.io/r-pharma-2023-tidymodels](https://nrennie.github.io/r-pharma-2023-tidymodels)

## Data

We'll use two data sets in this workshop:

* Examples data: Heart Failure Clinical Records. [archive.ics.uci.edu/dataset/519/heart+failure+clinical+records](http://archive.ics.uci.edu/dataset/519/heart+failure+clinical+records)

```{r}
#| label: read-data-example
#| echo: true
#| eval: false
heart_failure <- readr::read_csv("data/heart_failure.csv") 
```

<br>

* Exercises data: Physical Exercise in Patients with Subacute Stroke (PHYS-STROKE): safety analyses of six-month follow-up of a randomized clinical trial. [doi.org/10.5281/zenodo.3899830](https://doi.org/10.5281/zenodo.3899830)

```{r}
#| label: read-data-exercises
#| echo: true
#| eval: false
exercises <- readr::read_csv("data/exercises.csv") 
```

# Getting started with \{tidymodels\} {background-color="#D9DBDB"}

## What is {tidymodels}?

::: columns
::: {.column}

* A collection of R packages for statistical modelling and machine learning.

* Follows the {tidyverse} principles.

* `install.packages("tidymodels")`

:::

::: {.column}

![](images/tidymodels.png){fig-align="center" fig-alt="tidymodels R package hex sticker logo" width=50%}

:::
:::

## What is machine learning?

## Quiz!

Have you done machine learning in R before?

* No

* Yes, with {tidymodels}

* Yes, with {caret}

* Yes, with something else

## Types of machine learning

Aim:

* Classification
* Prediction


Process:

* Supervised
* Unsupervised

. . . 

* Semi-supervised


## Training and testing


## Training and testing in {tidymodels}

Live demo!

. . . 

See `examples/example_01.R` for full code.

## Exercise 1

Open `exercises/exercise_01.R` for prompts.

* Load the {tidyverse} and {tidymodels} packages

* Read in the `exercises.csv` data

* View and explore the data

* Perform the initial split (choose your own proportion!)

```{r}
#| label: ex-1-timer
countdown::countdown(minutes = 5,
                    color_border = "#b20e10",
                    color_text = "#b20e10",
                    color_running_text = "white",
                    color_running_background = "#b20e10",
                    color_finished_text = "#b20e10",
                    color_finished_background = "white",
                    top = 0,
                    margin = "1.2em",
                    font_size = "2em")
```

. . . 

See `exercise_solutions/exercise_solutions_01.R` for full code.

# Lasso regression {background-color="#D9DBDB"}

## Linear and logistic regression models

Let's go back a little bit first... 

::: columns

::: {.column}
**Linear regression**
```{r}
#| label: lin-reg
#| eval: false
#| echo: true
mod1 <- lm()
```
:::

::: {.column}
**Logistic regression**

```{r}
#| label: log-reg
#| eval: false
#| echo: true
mod2 <- glm()
```
:::

:::

## Quiz!

How do you choose which explanatory variables to include?

## Lasso regression

## Hyperparameter tuning

## Model evaluation


## Lasso logistic regression in {tidymodels}

Live demo!

. . . 

See `examples/example_02.R` for full code.


## Exercise 2

Open `exercises/exercise_02.R` for prompts. You can also use `examples/example_02.R` as a starting point.

* Build a recipe and specify the model.

* Create cross-validation folds and tune the hyperparameter.

* Choose the best value and fit the final model.

* Evaluate the model performance.

```{r}
#| label: ex-2-timer
countdown::countdown(minutes = 10,
                    color_border = "#b20e10",
                    color_text = "#b20e10",
                    color_running_text = "white",
                    color_running_background = "#b20e10",
                    color_finished_text = "#b20e10",
                    color_finished_background = "white",
                    top = 0,
                    margin = "1.2em",
                    font_size = "2em")
```

. . . 

See `exercise_solutions/exercise_solutions_02.R` for full code.

# Random Forests {background-color="#D9DBDB"}

## Decision trees

## What are Random Forests?

## Random Forests in {tidymodels}

Live demo!

. . . 

See `examples/example_03.R` for full code.

## Exercise 3

Open `exercises/exercise_03.R` for prompts.


```{r}
#| label: ex-3-timer
countdown::countdown(minutes = 10,
                    color_border = "#b20e10",
                    color_text = "#b20e10",
                    color_running_text = "white",
                    color_running_background = "#b20e10",
                    color_finished_text = "#b20e10",
                    color_finished_background = "white",
                    top = 0,
                    margin = "1.2em",
                    font_size = "2em")
```

. . . 

See `exercise_solutions/exercise_solutions_03.R` for full code.

# Support Vector Machines (SVM) {background-color="#D9DBDB"}

## What are Support Vector Machines?


## Support Vector Machines in {tidymodels}

Live demo!

. . . 

See `examples/example_04.R` for full code.

## Exercise 4

Open `exercises/exercise_04.R` for prompts.


```{r}
#| label: ex-4-timer
countdown::countdown(minutes = 10,
                    color_border = "#b20e10",
                    color_text = "#b20e10",
                    color_running_text = "white",
                    color_running_background = "#b20e10",
                    color_finished_text = "#b20e10",
                    color_finished_background = "white",
                    top = 0,
                    margin = "1.2em",
                    font_size = "2em")
```

. . . 

See `exercise_solutions/exercise_solutions_04.R` for full code.

# Additional Information {background-color="#D9DBDB"}

## Unsupervised learning

* K-means clustering

## Additional resources

* GitHub: [github.com/nrennie/r-pharma-2023-tidymodels](https://github.com/nrennie/r-pharma-2023-tidymodels)

* Slides: [nrennie.github.io/r-pharma-2023-tidymodels](https://nrennie.github.io/r-pharma-2023-tidymodels)

. . . 

* [Tidy Modeling with R](https://www.tmwr.org/)

* [Blog by Julia Silge](https://juliasilge.com/blog/)

## 

::: columns
::: {.column}

<br>

{{< fa brands twitter >}} [\@nrennie35](https://twitter.com/nrennie35)

{{< fa brands github >}} [nrennie](https://github.com/nrennie)

{{< fa globe >}} [nrennie.rbind.io](https://nrennie.rbind.io/)

{{< fa briefcase >}} [chicas.lancaster-university.uk](https://chicas.lancaster-university.uk/)

:::
::: {.column}

![](images/qr-code.png){fig-align="center" fig-alt="QR code" width=70%}

:::
:::

